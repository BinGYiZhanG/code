
* 没写完,
* [正解链接](https://blog.csdn.net/To_conquer_or_to_die/article/details/79770709)

```
#include <bits/stdc++.h>

using namespace std;

map<string,int> cate_level;///权限类名-->该类权限的最高等级
map<string,map<string,int> > role_priv;///该类角色一共有多少种权限，
map<string,vector<string> > user_roles;///用户包含的角色
map<string,set<string> > user_set;///用户包含的角色
char tmp[110];


void split(vector<string> &vec,char *str){
    char *p=strtok(str," ");
    while(p){
        vec.push_back(p);
        p=strtok(NULL," ");
    }
}

int find_judge(string user,string privi,int level){
    int maxclass=-1;
    bool flag=false;
    for(int i=0;i<(int)user_roles[user].size();i++){///遍历角色
        string role=user_roles[user][i];///取得角色
        if(role_priv[role].find(privi)!=role_priv[role].end()){
            //cout<<"role:"<<role<<";privi:"<<privi<<";class:"<<role_priv[role][privi]<<endl;
            if(level==-1&&role_priv[role][privi]!=-1){///取最高等级
                maxclass=max(maxclass,role_priv[role][privi]);
            }
            if(level!=-1&&(level<=role_priv[role][privi])){
                flag=true;
            }
                //return true;

        }
        //cout<<role<<endl;
        //map<string,int>::iterator it=role_priv[role].begin();
        //for(;it!=role_priv[role].end();it++)
          //  cout<<it->first<<" "<<it->second<<endl;
    }
    if(maxclass!=-1)
        return maxclass;
    else if(flag==true)
        return true;
    else
        return 0;
}

int main(){
    int p,r,u,q;
    string line;
    scanf("%d",&p);
    for(int i=0;i<p;i++){///处理权限的等级
        cin>>line;
        int pos=line.find(':');
        //printf("pos:%d\n",pos);
        string predex;
        if(pos!=-1)
            predex=line.substr(0,pos);
        else
            predex=line;
        string postdex;
        if(pos!=-1){
            cate_level[predex]=atoi(line.substr(pos+1).c_str());
        }
        else
            cate_level[predex]=-1;
        //cout<<predex<<"---"<<cate_level[predex]<<endl;
    }


    scanf("%d",&r);
    getchar();
    for(int i=0;i<r;i++){///处理该角色有多种权限,
        getline(cin,line);
        vector<string> vec;
        strcpy(tmp,line.c_str());
        split(vec,tmp);
        //for(int j=0;j<(int)vec.size();j++){
        //    cout<<j<<":"<<vec[j]<<";";
        //}
        //cout<<endl;
        string role=vec[0];
        int cnt=atoi(vec[1].c_str());
        for(int j=2;j<2+cnt;j++){
            int pos=vec[j].find(":"),classs;///等级:classs
            string privi;///
            if(pos!=-1){
                privi=vec[j].substr(0,pos);
                classs=atoi(vec[j].substr(pos+1).c_str());
            }
            else{
                privi=vec[j].substr(0,pos);
                classs=-1;
            }
            role_priv[role][privi]=classs;
        }
        //map<string,int>::iterator it=role_priv[role].begin();
        //cout<<"role:"<<role<<endl;
        //for(;it!=role_priv[role].end();it++){
        //    cout<<it->first<<" "<<it->second<<endl;
        //}
    }
    scanf("%d",&u);
    getchar();
    for(int i=0;i<u;i++){///处理该角色有多种权限,
        getline(cin,line);
        vector<string> vec1;
        strcpy(tmp,line.c_str());
        split(vec1,tmp);
        string user=vec1[0];
        int cnt1=atoi(vec1[1].c_str());
        for(int j=2;j<2+cnt1;j++){
            user_roles[user].push_back(vec1[j]);
            user_set[user].insert(vec1[j]);
        }
        //cout<<"user:"<<user<<endl;
        //for(int j=2;j<2+cnt1;j++)
        //    cout<<vec1[j]<<";";
        //cout<<endl;
    }
    scanf("%d",&q);
    getchar();
    for(int i=0;i<q;i++){///处理该角色有多种权限,
        getline(cin,line);
        vector<string> vec2;
        strcpy(tmp,line.c_str());
        split(vec2,tmp);
        string user2=vec2[0];///用户名
        string privi2=vec2[1];///权限
        //cout<<user2<<" "<<privi2<<endl;
        int pos2=privi2.find(":");
        if(pos2==-1){
            string privi3=privi2;
            int res=find_judge(user2,privi3,-1);
            if(res){
                if(res==1)
                    
            }
            else
                printf("false\n");
        }

        if(pos2!=-1){
            string privi3=privi2.substr(0,pos2);
            int cnt3=atoi(privi2.substr(pos2+1).c_str());
            if(find_judge(user2,privi3,cnt3))
                printf("true\n");
            else
                printf("false\n");
        }
    }
    return 0;
}


```
